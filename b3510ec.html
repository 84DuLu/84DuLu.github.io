<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>CPP 8 字符输入/输出 | Snow's Blog</title><meta name="keywords" content="C"><meta name="author" content="snow"><meta name="copyright" content="snow"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="C Primer Plus 第8章笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="CPP 8 字符输入&#x2F;输出">
<meta property="og:url" content="http://example.com/b3510ec.html">
<meta property="og:site_name" content="Snow&#39;s Blog">
<meta property="og:description" content="C Primer Plus 第8章笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.ghibli.jp/gallery/thumb-totoro047.png">
<meta property="article:published_time" content="2022-04-15T11:52:16.000Z">
<meta property="article:modified_time" content="2022-05-15T09:53:12.553Z">
<meta property="article:author" content="snow">
<meta property="article:tag" content="C">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.ghibli.jp/gallery/thumb-totoro047.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/b3510ec"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CPP 8 字符输入/输出',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-15 17:53:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/modify.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://img.wxcha.com/m00/83/1a/d15d6c952997c5e4dea24a316e20f272.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://www.ghibli.jp/gallery/thumb-totoro047.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Snow's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CPP 8 字符输入/输出</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-15T11:52:16.000Z" title="发表于 2022-04-15 19:52:16">2022-04-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-15T09:53:12.553Z" title="更新于 2022-05-15 17:53:12">2022-05-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C%E8%AF%AD%E8%A8%80/">C语言</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CPP 8 字符输入/输出"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="第八章-字符输入-输出"><a href="#第八章-字符输入-输出" class="headerlink" title="第八章 字符输入/输出"></a>第八章 字符输入/输出</h1><h2 id="单字符I-O：getchar-和-putchar"><a href="#单字符I-O：getchar-和-putchar" class="headerlink" title="单字符I/O：getchar() 和 putchar()"></a>单字符I/O：getchar() 和 putchar()</h2><p><code>getchar()</code> 和 <code>putchar</code> 每次只处理一个字符。自从 ANSI C 标准发布以后，<strong>C</strong> 就把 stdio.h 头文件与使用 <code>getchar()</code> 和 <code>putchar()</code> 相关联。</p>
<h3 id="缓冲区"><a href="#缓冲区" class="headerlink" title="缓冲区"></a>缓冲区</h3><p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220415195844577.png" alt="image-20220415195844577"></p>
<p>缓冲分为两类：完全缓冲 I/O 和行缓冲 I/O。完全缓冲输入指的是当缓冲区被填满时才刷新缓冲区，通常出现在文件输入中。缓冲区的大小取决于系统，常见的大小是 512 字节和 4096 字节。行缓冲 I/O 指的是在出现换行符时刷新缓冲区。键盘输入通常是行缓冲输入，所以在按下 Enter 键后才刷新缓冲区。</p>
<p>虽然缓冲输入好处很多，但是某些交互式程序也需要无缓冲输入。例如，在游戏中。</p>
<h2 id="结束键盘输入"><a href="#结束键盘输入" class="headerlink" title="结束键盘输入"></a>结束键盘输入</h2><h3 id="文件、流和键盘输入"><a href="#文件、流和键盘输入" class="headerlink" title="文件、流和键盘输入"></a>文件、流和键盘输入</h3><p>A <em>file</em> is an area of memory in which information is stored. Normally, a file is kept in some sort of permanent memory, such as a hard disk, USB flash drive.</p>
<p>When you are using the standard I/O package, you are shielded from differences in different systems. Therefore, to check for a new line, you can use <code>if (ch == &#39;\n&#39;)</code>. If the system actually uses the carriage return/linefeed combination, the I/O functions automatically translate back and forth between the two representations.</p>
<p>Conceptually, the <strong>C</strong> program deals with a stream instead of directly with a file. A <em>stream</em> is an idealized flow of date to which the actual input or output is mapped. That means various kinds of input with differing properties are represented by streams with more uniform properties. The process of opening a file then becomes one of associating a stream with the file, and reading and writing take place via the stream.</p>
<h3 id="The-End-of-File"><a href="#The-End-of-File" class="headerlink" title="The End of File"></a>The End of File</h3><p>无论操作系统实际使用何种方法检测文件结尾，在C语言中，用<code>getchar()</code>读取文件检测到文件结尾时将返回一个特殊的值，即 <strong>EOF</strong>（end of file 的缩写)。<code>scanf()</code>函数检测到文件结尾时也返回 EOF 。通常， EOF 定义在 stdio.h 文件中：</p>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220415203947670.png" alt="image-20220415203947670"></p>
<p>Why -1? Normally, <code>getchar()</code> returns a value in the range 0 through 127, because those are values corresponding to the standard character set, but it might return values from 0 through 255 if the system recognizes an extended character set. In either case, the value -1 does not correspond to any character, so it can be used to signal the end of a file.</p>
<p>以下程序展现了怎么使用 EOF 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ch;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> ((ch = getchar()) != EOF)</span><br><span class="line">        <span class="built_in">putchar</span>(ch);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>无需再定义 EOF ，因为 stdio.h 中已经定义过了。</li>
<li>变量 ch 的类型要用 <strong>int</strong> ，因为 <strong>char</strong> 类型的变量只能表示 0 ~ 255 的无符号整数，但是 EOF 的值是 -1。<code>getchar()</code> 函数的实际返回值的类型是 <strong>int</strong> ，所以它可以读取 EOF 字符。如果实现使用有符号的 <strong>char</strong> 类型，也可以把 ch 声明为 <strong>char</strong> 类型，但最好还是用更通用的形式。</li>
<li>由于 <code>getchar()</code>函数的返回类型是 <strong>int</strong> ，如果把<code>getchar()</code>的返回值赋给 <strong>char</strong> 类型的变量，一些编译器会警告可能丢失数据。</li>
<li>使用该程序进行键盘输入，要设法输入 EOF 字符。不能只输入字符 EOF ，也不能只输入 -1。正确的方法是，必须找出当前系统的要求。例如，在大多数 UNIX 和 LINUX 系统中，在一行开始处按下 <kbd>Ctrl</kbd>+<kbd>D</kbd>会传输文件结尾信号；在 PC中，要按下<kbd>Ctrl</kbd>+<kbd>Z</kbd>。</li>
</ul>
<h2 id="重定向和文件"><a href="#重定向和文件" class="headerlink" title="重定向和文件"></a>重定向和文件</h2><p>重定向输入让程序使用文件而不是键盘来输入，重定向输出让程序输出至文件而不是屏幕。</p>
<h3 id="重定向输入"><a href="#重定向输入" class="headerlink" title="重定向输入"></a>重定向输入</h3><p>假设已经编译了 echo_eof.c 程序，并生成了一个名为 echo_eof （或者在 Windows 系统中名为 echo_eof.exe）的可执行文件。运行该程序，输入可执行文件名：<code>./echo_eof</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220416083513919.png" alt="image-20220416083513919"></p>
<p>我们在当前目录新建一个名为 hello.txt 的文件，并输入一些字符。我们使用重定向运算符 <strong>&lt;</strong> 使 hello.txt 文件与 stdin 流相关联，把文件中的内容导入 echo_eof 程序。echo_eof 程序本身并不知道（或不关心）输入的内容来自文件还是键盘，它只知道这是需要导入的字符流。<br>我们在终端上打上 <code>./echo_eof &lt; hello.txt</code> 。</p>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220416084842633.png" alt="image-20220416084842633"></p>
<p>屏幕上显示了我们之前在 hello.txt 中编辑的内容。</p>
<h3 id="重定向输出"><a href="#重定向输出" class="headerlink" title="重定向输出"></a>重定向输出</h3><p>现在假设要用 echo_eof 把键盘输入的内容发送到名为 snow 的文件中。然后，输入以下命令并开始输入：</p>
<p><code>./echo_eof&gt;snow</code></p>
<p><strong>&gt;</strong> 符号是第2个重定向运算符。它创建了一个名为 snow 的新文件，然后把 echo_eof 的输出重定向至该文件中。重定向把 stdout 从显示设备赋给 snow 文件。在新一行的开始处按下 <kbd>Crtl</kbd>+<kbd>Z</kbd>结束该程序。</p>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220416090207480.png" alt="image-20220416090207480"></p>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220416090717130.png" alt="image-20220416090717130"></p>
<h3 id="组合重定向"><a href="#组合重定向" class="headerlink" title="组合重定向"></a>组合重定向</h3><p>现在，建设你希望制作一份 snow 文件的副本，并命名为 savesnow。只需输入以下命令即可：</p>
<p><code>./echo_eof &lt; snow &gt; savesnow</code></p>
<p>下面的命令也起作用，因为命令与重定向运算符的顺序无关：</p>
<p><code>./echo_eof &gt; savesnow &lt; save</code></p>
<p>使用重定向运算符需要遵循的原则：</p>
<ul>
<li>重定向运算符连接一个可执行程序和一个数据文件，不能用于连接一个数据文件和另一个数据文件，也不能用于连接一个程序和另一个程序。</li>
<li>使用重定向运算符不能读取多个文件的输入，也不能把输出定向至多个文件。</li>
<li>通常，文件名和运算符之间的空格不是必须的。</li>
</ul>
<h2 id="创建更友好的用户界面"><a href="#创建更友好的用户界面" class="headerlink" title="创建更友好的用户界面"></a>创建更友好的用户界面</h2><h3 id="使用缓冲输入"><a href="#使用缓冲输入" class="headerlink" title="使用缓冲输入"></a>使用缓冲输入</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* guess.c -- an inefficient and faulty number-guesser */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> guess = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Pick an integer from 1 to 100. I will try to guess &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;it.\nRespond with a y if my guess is right and with&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nan n if it is wrong.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Uh...is your number %d?\n&quot;</span>, guess);</span><br><span class="line">    <span class="keyword">while</span> (getchar() != <span class="string">&#x27;y&#x27;</span>)      <span class="comment">/* get response, compare to y */</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Well, then, is it %d?\n&quot;</span>, ++guess);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I knew I could do it!\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220416093951228.png" alt="image-20220416093951228"></p>
<p>我们来看看这个程序中都有什么问题。我们输入 n，程序居然打印了两条消息，假如我们心里想的是2，那么就猜失败了。错误的原因是，<code>getchar()</code>不仅读取了 n，还读取了我们为了刷新缓冲区的换行符，no 的错误同理。我们来修正这个问题。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (getchar() != <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Well, then, is it %d?\n&quot;</span>, ++guess);</span><br><span class="line">    <span class="keyword">while</span> (getchar() != <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220416094828992.png" alt="image-20220416094828992"></p>
<p>我们先来分析下新加的这两行代码的好处。如果输入一个 n 和一个换行符的话，n 被外层 <strong>while</strong> 的<code>getchar()</code>接受，换行符被内层 <strong>while</strong> 接受，由于换行符不满足内层 <strong>while</strong> 的条件，会开启一轮新的外层循环。如果 n 之后有别的字符，其满足内层 <strong>while</strong> 的条件，进入后遇到 <code>continue;</code>，将会重新开始内层循环。所以这两行代码及解决掉了换行符的问题，也解决掉了多余字符的问题。</p>
<p>但是，该程序仍会把别的字符视为 n 。我们来解决这个问题。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> response;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((response = getchar()) != <span class="string">&#x27;y&#x27;</span>)    </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (response == <span class="string">&#x27;n&#x27;</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Well, then, is it %d?\n&quot;</span>, ++guess);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Sorry, I understand only y or n.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (getchar() != <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span>;                 </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>我们添加一个 <strong>char</strong> 类型的变量和 <strong>if</strong> 语句来进行筛选。</p>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220416100225969.png" alt="image-20220416100225969"></p>
<h3 id="混合数值和字符输入"><a href="#混合数值和字符输入" class="headerlink" title="混合数值和字符输入"></a>混合数值和字符输入</h3><p>该程序读入一个字符和两个数字，然后根据输入的两个数字指定的行数和列数打印该字符。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(<span class="type">char</span> cr, <span class="type">int</span> lines, <span class="type">int</span> width)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ch;             <span class="comment">/* character to be printed    */</span></span><br><span class="line">    <span class="type">int</span> rows, cols;     <span class="comment">/* number of rows and columns */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter a character and two integers:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> ((ch = getchar()) != <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;rows, &amp;cols);</span><br><span class="line">        display(ch, rows, cols);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter another character and two integers;\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter a newline to quit.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Bye.\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(<span class="type">char</span> cr, <span class="type">int</span> lines, <span class="type">int</span> width)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> row, col;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (row = <span class="number">1</span>; row &lt;= lines; row++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (col = <span class="number">1</span>; col &lt;= width; col++)</span><br><span class="line">            <span class="built_in">putchar</span>(cr);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">/* end line and start a new one */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/84DuLu/img/img/image-20220416101937714.png" alt="image-20220416101937714"></p>
<p>屏幕上提示我们再输入字符，但没来得及输出，程序就退出了，这是什么原因呢？其实跟上例相似，又是换行符的问题。<code>scanf()</code>把我们用于刷新缓冲区的换行符仍留在输入队列中。和<code>scanf()</code>不同，<code>getchar()</code>不会跳过换行符，所以在进入下一轮迭代时，还没来得及输入字符，它就读取了换行符，然后将其赋给 ch 。</p>
<p>我们用与上例相仿的解决方案 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ((ch = getchar()) != <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;rows, &amp;cols) != <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        display(ch, rows, cols);</span><br><span class="line">        <span class="keyword">while</span> (getchar() !=  <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter another character and two integers;\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter a newline to quit.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>while</strong> 循环实现了丢弃<code>scanf()</code>输入后面所有字符（包括换行符）的功能。值得注意的是，我们在 <strong>if</strong>  语句中使用一个 <strong>break</strong> 语句，可以在 <code>scanf()</code> 的返回值不等于2时终止程序，即如果一个或两个输入值不是整数或者遇到文件结尾就终止程序。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">snow</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/b3510ec.html">http://example.com/b3510ec.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Snow's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C</a></div><div class="post_share"><div class="social-share" data-image="https://www.ghibli.jp/gallery/thumb-totoro047.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/b3510ed.html"><img class="prev-cover" src="https://www.ghibli.jp/gallery/thumb-totoro047.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CPP 7 C控制语句：分支和跳转</div></div></a></div><div class="next-post pull-right"><a href="/ea231a5f.html"><img class="next-cover" src="https://www.ghibli.jp/gallery/thumb-totoro047.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CPP 9 函数</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/eaf9ae16.html" title="CPP 13 文件输入/输出"><img class="cover" src="https://www.ghibli.jp/gallery/thumb-totoro029.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-21</div><div class="title">CPP 13 文件输入/输出</div></div></a></div><div><a href="/d0b81e3c.html" title="CPP 14 结构和其他数据形式"><img class="cover" src="https://www.ghibli.jp/gallery/thumb-totoro029.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-29</div><div class="title">CPP 14 结构和其他数据形式</div></div></a></div><div><a href="/3f1e1e54.html" title="CPP 12 存储类别、链接和内存管理"><img class="cover" src="https://www.ghibli.jp/gallery/thumb-totoro029.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-14</div><div class="title">CPP 12 存储类别、链接和内存管理</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://img.wxcha.com/m00/83/1a/d15d6c952997c5e4dea24a316e20f272.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">snow</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/84DuLu"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%AD%97%E7%AC%A6%E8%BE%93%E5%85%A5-%E8%BE%93%E5%87%BA"><span class="toc-number">1.</span> <span class="toc-text">第八章 字符输入&#x2F;输出</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%AD%97%E7%AC%A6I-O%EF%BC%9Agetchar-%E5%92%8C-putchar"><span class="toc-number">1.1.</span> <span class="toc-text">单字符I&#x2F;O：getchar() 和 putchar()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">1.1.1.</span> <span class="toc-text">缓冲区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F%E9%94%AE%E7%9B%98%E8%BE%93%E5%85%A5"><span class="toc-number">1.2.</span> <span class="toc-text">结束键盘输入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E3%80%81%E6%B5%81%E5%92%8C%E9%94%AE%E7%9B%98%E8%BE%93%E5%85%A5"><span class="toc-number">1.2.1.</span> <span class="toc-text">文件、流和键盘输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-End-of-File"><span class="toc-number">1.2.2.</span> <span class="toc-text">The End of File</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E5%92%8C%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">重定向和文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E8%BE%93%E5%85%A5"><span class="toc-number">1.3.1.</span> <span class="toc-text">重定向输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E8%BE%93%E5%87%BA"><span class="toc-number">1.3.2.</span> <span class="toc-text">重定向输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.3.3.</span> <span class="toc-text">组合重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9B%B4%E5%8F%8B%E5%A5%BD%E7%9A%84%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2"><span class="toc-number">1.4.</span> <span class="toc-text">创建更友好的用户界面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BC%93%E5%86%B2%E8%BE%93%E5%85%A5"><span class="toc-number">1.4.1.</span> <span class="toc-text">使用缓冲输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E6%95%B0%E5%80%BC%E5%92%8C%E5%AD%97%E7%AC%A6%E8%BE%93%E5%85%A5"><span class="toc-number">1.4.2.</span> <span class="toc-text">混合数值和字符输入</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/d0b81e3c.html" title="CPP 14 结构和其他数据形式"><img src="https://www.ghibli.jp/gallery/thumb-totoro029.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CPP 14 结构和其他数据形式"/></a><div class="content"><a class="title" href="/d0b81e3c.html" title="CPP 14 结构和其他数据形式">CPP 14 结构和其他数据形式</a><time datetime="2022-05-29T07:33:26.000Z" title="发表于 2022-05-29 15:33:26">2022-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/eaf9ae16.html" title="CPP 13 文件输入/输出"><img src="https://www.ghibli.jp/gallery/thumb-totoro029.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CPP 13 文件输入/输出"/></a><div class="content"><a class="title" href="/eaf9ae16.html" title="CPP 13 文件输入/输出">CPP 13 文件输入/输出</a><time datetime="2022-05-21T10:29:29.000Z" title="发表于 2022-05-21 18:29:29">2022-05-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/3f1e1e54.html" title="CPP 12 存储类别、链接和内存管理"><img src="https://www.ghibli.jp/gallery/thumb-totoro029.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CPP 12 存储类别、链接和内存管理"/></a><div class="content"><a class="title" href="/3f1e1e54.html" title="CPP 12 存储类别、链接和内存管理">CPP 12 存储类别、链接和内存管理</a><time datetime="2022-05-14T09:22:09.000Z" title="发表于 2022-05-14 17:22:09">2022-05-14</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2022 By snow</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadGiscus () {
  let nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : ''

  const config = Object.assign({
    src: 'https://giscus.app/client.js',
    'data-repo': '84DuLu/84DuLu.github.io',
    'data-repo-id': 'R_kgDOHHKm_A',
    'data-category-id': 'DIC_kwDOHHKm_M4COZ5J',
    'data-mapping': 'pathname',
    'data-theme': nowTheme,
    'data-reactions-enabled': '1',
    crossorigin: 'anonymous',
    async: true
  },null)

  let ele = document.createElement('script')
  for (let key in config) {
    ele.setAttribute(key, config[key])
  }
  document.getElementById('giscus-wrap').insertAdjacentElement('afterbegin',ele)
}

function changeGiscusTheme () {
  const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : ''

  function sendMessage(message) {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }

  sendMessage({
    setConfig: {
      theme: theme
    }
  });
}

if ('Giscus' === 'Giscus' || !false) {
  if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
  else loadGiscus()
} else {
  function loadOtherComment () {
    loadGiscus()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>